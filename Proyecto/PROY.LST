Turbo Assembler	 Version 4.1	    04/18/19 16:25:49	    Page 1
proy.ASM



      1				     include macro.asm
1     2				     pintarM macro
1     3					     mov ah, 0Ch
1     4					     mov al, ColorCommand; color
1     5					     mov bh, 0
1     6					     int 10h
1     7				     endm
1     8
1     9				     ppila macro
1    10					     push cx
1    11					     push bx
1    12					     call busqueda
1    13					     pop cx
1    14				     endm
     15				     ;------------------------------------------------------------------------------
     16
     17	0000			     Pila Segment
     18	0000  FFFF*(??)		      db 0FFFFh	Dup (?)
     19	FFFF			     Pila EndS
     20
     21				     ;------------------------------------------------------------------------------
     22
     23	0000			     Datos Segment
     24	0000  70 65 72 69 63 6F	2E+	     filename db 'perico.bmp',0
     25	      62 6D 70 00
     26	000B  68 6F 6C 61		     clave db 'hola'
     27
     28	000F  00 04 02 06 01 05	03+	     paleta  db	00h, 04h, 02h, 06h, 01h, 05h, 03h, 07h,	08h, 0Ch, 0Ah, 0Eh, 9h,	0Dh, 0Bh, 0Fh
     29	      07 08 0C 0A 0E 09	0D+
     30	      0B 0F
     31
     32	001F  ????			     filehandle	dw ?
     33
     34	0021  76*(00)			     Header db 118 dup (0)
     35	0097  0280*(00)			     Header2 db	640 dup	(0)
     36	0317  ??			     ColorCommand db ?
     37
     38	0318  ????			     ancho dw ?
     39	031A  ????			     largo dw ?
     40
     41	031C  45 72 72 6F 72 0D	0A+	     ErrorMsg db 'Error', 13, 10,'$'
     42	      24
     43	0324			     Datos EndS
     44
     45	0000			     Codigo Segment
     46				     Assume CS:Codigo, DS:Datos
     47
     48	0000			     sumadorC proc near
     49
     50
     51
     52	0000			     sumadorC endp
     53
     54	0000			     busqueda proc near
     55	0000  59			     pop cx
     56	0001  58			     pop ax
     57	0002  51			     push cx
Turbo Assembler	 Version 4.1	    04/18/19 16:25:49	    Page 2
proy.ASM



     58	0003  8A C4			     mov al, ah
     59	0005  32 E4			     xor ah, ah
     60	0007  BB 000Fr			     lea bx, paleta
     61	000A  D7			     xlat
     62	000B  A2 0317r			     mov ColorCommand, al
     63	000E  C3			     ret
     64	000F			     endP
     65
     66	000F			     OpenFile proc
     67	000F  B4 3D			     mov ah, 3Dh
     68	0011  32 C0			     xor al, al
     69	0013  BA 0000r			     mov dx, offset filename
     70	0016  CD 21			     int 21h
     71
     72	0018  72 04			     jc	openerror
     73	001A  A3 001Fr			     mov [filehandle], ax
     74	001D  C3			     ret
     75
     76	001E				     openerror:
     77	001E  BA 031Cr			     mov dx, offset ErrorMsg
     78	0021  B4 09			     mov ah, 9h
     79	0023  CD 21			     int 21h
     80
     81	0025  C3			     ret
     82	0026			     endp OpenFile
     83
     84	0026			     ReadHeader	proc
     85	0026  B4 3F			     mov ah,3fh
     86	0028  8B 1E 001Fr		     mov bx,[filehandle]
     87	002C  B9 0076			     mov cx,118
     88	002F  BA 0021r			     mov dx,offset Header
     89	0032  CD 21			     int 21h
     90
     91	0034  50			     push ax
     92	0035  8A 26 0034r		     mov ah, [Header]+19
     93	0039  A0 0033r			     mov al, [Header]+18
     94	003C  A3 0318r			     mov ancho,	ax
     95
     96	003F  8A 26 0038r		     mov ah, [Header]+23
     97	0043  A0 0037r			     mov al, [Header]+22
     98	0046  A3 031Ar			     mov largo,	ax
     99	0049  58			     pop ax
    100
    101	004A  B4 3E			     mov ah,3eh
    102	004C  8B 1E 001Fr		     mov bx,FileHandle
    103	0050  CD 21			     int 21h
    104
    105	0052  B4 3D			     mov ah, 3Dh
    106	0054  32 C0			     xor al, al
    107	0056  BA 0000r			     mov dx, offset filename
    108	0059  CD 21			     int 21h
    109
    110	005B  B4 3F			     mov ah,3fh
    111	005D  8B 1E 001Fr		     mov bx,[filehandle]
    112	0061  B9 0076			     mov cx,118
    113	0064  BA 0021r			     mov dx,offset Header
    114	0067  CD 21			     int 21h
Turbo Assembler	 Version 4.1	    04/18/19 16:25:49	    Page 3
proy.ASM



    115
    116	0069  C3			     ret
    117	006A			     endp ReadHeader
    118
    119	006A			     pintar proc
    120	006A  B4 00			     mov ah, 00h
    121	006C  B0 12			     mov al, 12h
    122	006E  CD 10			     int 10h
    123	0070  BA 01E0			     mov dx, 1E0H
    124	0073  52			     push dx
    125	0074			     ploop:
    126
    127	0074  B8 3F00			     mov ax,3f00h
    128	0077  8B 1E 001Fr		     mov bx,[filehandle]
    129	007B  B9 0140			     mov cx,140h
    130	007E  BA 0097r			     mov dx,offset Header2
    131	0081  CD 21			     int 21h
    132	0083  BE 0097r			     lea si, [header2]
    133	0086  5A			     pop dx
    134	0087  83 FA 00			     cmp dx, 0
    135	008A  74 57			     jz	final
    136	008C  B9 0000			     mov cx, 0
    137	008F				     sloop:
    138	008F  81 F9 0280			     cmp cx, 280h
    139	0093  74 3C				     jz	floop
    140	0095  8A 04				     mov al, byte ptr [si]
    141	0097  8A 24				     mov ah, byte ptr [si]
    142	0099  46				     inc si
    143	009A  24 0F				     and al, 00001111b
    144	009C  80 E4 F0				     and ah, 11110000b
    145	009F  D0 C4 D0 C4 D0 C4	D0+		     rol Ah, 4
    146	      C4
    147	00A7  8B D8				     mov bx, ax
    148	00A9  53				     push bx
    149						     ;---------
    150	00AA  33 C0				     xor ax,ax
    151						     ppila
1   152	00AC  51			     push cx
1   153	00AD  53			     push bx
1   154	00AE  E8 FF4F			     call busqueda
1   155	00B1  59			     pop cx
    156						     pintarM
1   157	00B2  B4 0C			     mov ah, 0Ch
1   158	00B4  A0 0317r			     mov al, ColorCommand; color
1   159	00B7  B7 00			     mov bh, 0
1   160	00B9  CD 10			     int 10h
    161						     ;---------
    162	00BB  41				     inc cx
    163	00BC  5B				     pop bx
    164	00BD  8A FB				     mov bh, bl
    165						     ppila
1   166	00BF  51			     push cx
1   167	00C0  53			     push bx
1   168	00C1  E8 FF3C			     call busqueda
1   169	00C4  59			     pop cx
    170						     pintarM
1   171	00C5  B4 0C			     mov ah, 0Ch
Turbo Assembler	 Version 4.1	    04/18/19 16:25:49	    Page 4
proy.ASM



1   172	00C7  A0 0317r			     mov al, ColorCommand; color
1   173	00CA  B7 00			     mov bh, 0
1   174	00CC  CD 10			     int 10h
    175	00CE  41				     inc cx
    176						     ;---------
    177	00CF  EB BE				     jmp sloop
    178	00D1			     floop:
    179	00D1  4A			     dec dx
    180	00D2  52			     push dx
    181	00D3  EB 9F			     jmp ploop
    182	00D5			     endp pintar
    183
    184	00D5			     Inicio:
    185	00D5  B8 0000s			     mov ax, datos
    186	00D8  8E D8			     mov ds, ax
    187
    188
    189	00DA  E8 FF32			     call openFile
    190	00DD  E8 FF46			     call ReadHeader
    191	00E0  E8 FF87			     call pintar
    192
    193	00E3			     final:
    194	00E3  B4 3E			     mov ah,3eh
    195	00E5  8B 1E 001Fr		     mov bx,FileHandle
    196	00E9  CD 21			     int 21h
    197
    198	00EB  B4 10			     mov ah,10h
    199	00ED  CD 16			     int 16h
    200
    201	00EF  B8 0003			     mov ax,0003h
    202	00F2  CD 10			     int 10h
    203
    204	00F4  B8 4C00			     mov ax, 4C00h
    205	00F7  CD 21			     int 21h
    206	00F9			     Codigo EndS
    207					     End Inicio
Turbo Assembler	 Version 4.1	    04/18/19 16:25:49	    Page 5
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "04/18/19"
??FILENAME			  Text	 "proy	  "
??TIME				  Text	 "16:25:49"
??VERSION			  Number 040A
@CPU				  Text	 0101H
@CURSEG				  Text	 CODIGO
@FILENAME			  Text	 PROY
@WORDSIZE			  Text	 2
ANCHO				  Word	 DATOS:0318
BUSQUEDA			  Near	 CODIGO:0000
CLAVE				  Byte	 DATOS:000B
COLORCOMMAND			  Byte	 DATOS:0317
ERRORMSG			  Byte	 DATOS:031C
FILEHANDLE			  Word	 DATOS:001F
FILENAME			  Byte	 DATOS:0000
FINAL				  Near	 CODIGO:00E3
FLOOP				  Near	 CODIGO:00D1
HEADER				  Byte	 DATOS:0021
HEADER2				  Byte	 DATOS:0097
INICIO				  Near	 CODIGO:00D5
LARGO				  Word	 DATOS:031A
OPENERROR			  Near	 CODIGO:001E
OPENFILE			  Near	 CODIGO:000F
PALETA				  Byte	 DATOS:000F
PINTAR				  Near	 CODIGO:006A
PLOOP				  Near	 CODIGO:0074
READHEADER			  Near	 CODIGO:0026
SLOOP				  Near	 CODIGO:008F
SUMADORC			  Near	 CODIGO:0000

Macro Name

PINTARM
PPILA

Groups & Segments		  Bit Size Align  Combine Class

CODIGO				  16  00F9 Para	  none
DATOS				  16  0324 Para	  none
PILA				  16  FFFF Para	  none
