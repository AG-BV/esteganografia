Turbo Assembler	 Version 4.1	    04/18/19 00:57:53	    Page 1
proy.ASM



      1				     ;------------------------------------------------------------------------------
      2
      3	0000			     Pila Segment
      4	0000  FFFF*(??)		      db 0FFFFh	Dup (?)
      5	FFFF			     Pila EndS
      6
      7				     ;------------------------------------------------------------------------------
      8
      9	0000			     Datos Segment
     10	0000  69 6D 61 67 65 6E	2E+	     filename db 'imagen.bmp',0
     11	      62 6D 70 00
     12
     13	000B  00 04 02 06 01 05	03+	     paleta  db	00h, 04h, 02h, 06h, 01h, 05h, 03h, 07h,	08h, 0Ch, 0Ah, 0Eh, 9h,	0Dh, 0Bh, 0Fh
     14	      07 08 0C 0A 0E 09	0D+
     15	      0B 0F
     16
     17	001B  ????			     filehandle	dw ?
     18
     19	001D  76*(00)			     Header db 118 dup (0)
     20	0093  0280*(00)			     Header2 db	640 dup	(0)
     21	0313  ??			     ColorCommand db ?
     22
     23	0314  ????			     ancho dw ?
     24	0316  ????			     largo dw ?
     25
     26	0318  45 72 72 6F 72 0D	0A+	     ErrorMsg db 'Error', 13, 10,'$'
     27	      24
     28	0320			     Datos EndS
     29
     30	0000			     Codigo Segment
     31				     Assume CS:Codigo, DS:Datos
     32
     33	0000			     busqueda proc near
     34	0000  59			     pop cx
     35	0001  58			     pop ax
     36	0002  51			     push cx
     37	0003  8A C4			     mov al, ah
     38	0005  32 E4			     xor ah, ah
     39	0007  BB 000Br			     lea bx, paleta
     40	000A  D7			     xlat
     41	000B  A2 0313r			     mov ColorCommand, al
     42	000E  C3			     ret
     43	000F			     endP
     44
     45	000F			     OpenFile proc
     46	000F  B4 3D			     mov ah, 3Dh
     47	0011  32 C0			     xor al, al
     48	0013  BA 0000r			     mov dx, offset filename
     49	0016  CD 21			     int 21h
     50
     51	0018  72 04			     jc	openerror
     52	001A  A3 001Br			     mov [filehandle], ax
     53	001D  C3			     ret
     54
     55	001E				     openerror:
     56	001E  BA 0318r			     mov dx, offset ErrorMsg
     57	0021  B4 09			     mov ah, 9h
Turbo Assembler	 Version 4.1	    04/18/19 00:57:53	    Page 2
proy.ASM



     58	0023  CD 21			     int 21h
     59	0025  C3			     ret
     60	0026			     endp OpenFile
     61
     62	0026			     ReadHeader	proc
     63	0026  B4 3F			     mov ah,3fh
     64	0028  8B 1E 001Br		     mov bx,[filehandle]
     65	002C  B9 0076			     mov cx,118
     66	002F  BA 001Dr			     mov dx,offset Header
     67	0032  CD 21			     int 21h
     68
     69	0034  50			     push ax
     70	0035  8A 26 0030r		     mov ah, [Header]+19
     71	0039  A0 002Fr			     mov al, [Header]+18
     72	003C  A3 0314r			     mov ancho,	ax
     73
     74	003F  8A 26 0034r		     mov ah, [Header]+23
     75	0043  A0 0033r			     mov al, [Header]+22
     76	0046  A3 0316r			     mov largo,	ax
     77	0049  58			     pop ax
     78
     79	004A  C3			     ret
     80	004B			     endp ReadHeader
     81
     82	004B			     pintar proc
     83	004B  B4 00			     mov ah, 00h
     84	004D  B0 12			     mov al, 12h
     85	004F  CD 10			     int 10h
     86	0051  BA 01E0			     mov dx, 1E0H
     87	0054  52			     push dx
     88	0055			     ploop:
     89
     90	0055  B8 3F00			     mov ax,3f00h
     91	0058  8B 1E 001Br		     mov bx,[filehandle]
     92	005C  B9 0140			     mov cx,140h
     93	005F  BA 0093r			     mov dx,offset Header2
     94	0062  CD 21			     int 21h
     95	0064  BE 0093r			     lea si, [header2]
     96	0067  5A			     pop dx
     97	0068  83 FA 00			     cmp dx, 0
     98	006B  74 57			     jz	final
     99	006D  B9 0000			     mov cx, 0
    100	0070				     sloop:
    101	0070  81 F9 0280			     cmp cx, 280h
    102	0074  74 3C				     jz	floop
    103	0076  8A 04				     mov al, byte ptr [si]
    104	0078  8A 24				     mov ah, byte ptr [si]
    105	007A  46				     inc si
    106	007B  24 0F				     and al, 00001111b
    107	007D  80 E4 F0				     and ah, 11110000b
    108	0080  D0 C4 D0 C4 D0 C4	D0+		     rol Ah, 4
    109	      C4
    110	0088  8B D8				     mov bx, ax
    111	008A  53				     push bx
    112						     ;---------
    113	008B  33 C0				     xor ax,ax
    114	008D  51				     push cx
Turbo Assembler	 Version 4.1	    04/18/19 00:57:53	    Page 3
proy.ASM



    115	008E  53				     push bx
    116	008F  E8 FF6E				     call busqueda
    117	0092  59				     pop cx
    118	0093  B4 0C				     mov ah, 0Ch
    119	0095  A0 0313r				     mov al, ColorCommand; color
    120	0098  B7 00				     mov bh, 0
    121	009A  CD 10				     int 10h
    122						     ;---------
    123	009C  41				     inc cx
    124	009D  5B				     pop bx
    125	009E  8A FB				     mov bh, bl
    126	00A0  51				     push cx
    127	00A1  53				     push bx
    128	00A2  E8 FF5B				     call busqueda
    129	00A5  59				     pop cx
    130	00A6  B4 0C				     mov ah, 0Ch
    131	00A8  A0 0313r				     mov al, ColorCommand; color
    132	00AB  B7 00				     mov bh, 0
    133	00AD  CD 10				     int 10h
    134	00AF  41				     inc cx
    135						     ;---------
    136	00B0  EB BE				     jmp sloop
    137	00B2			     floop:
    138	00B2  4A			     dec dx
    139	00B3  52			     push dx
    140	00B4  EB 9F			     jmp ploop
    141	00B6			     endp pintar
    142
    143	00B6			     Inicio:
    144	00B6  B8 0000s			     mov ax, datos
    145	00B9  8E D8			     mov ds, ax
    146
    147	00BB  E8 FF51			     call openFile
    148	00BE  E8 FF65			     call ReadHeader
    149	00C1  E8 FF87			     call pintar
    150
    151	00C4			     final:
    152	00C4  B4 10			     mov ah,10h
    153	00C6  CD 16			     int 16h
    154
    155	00C8  B8 0003			     mov ax,0003h
    156	00CB  CD 10			     int 10h
    157
    158	00CD  B8 4C00			     mov ax, 4C00h
    159	00D0  CD 21			     int 21h
    160	00D2			     Codigo EndS
    161					     End Inicio
Turbo Assembler	 Version 4.1	    04/18/19 00:57:53	    Page 4
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "04/18/19"
??FILENAME			  Text	 "proy	  "
??TIME				  Text	 "00:57:53"
??VERSION			  Number 040A
@CPU				  Text	 0101H
@CURSEG				  Text	 CODIGO
@FILENAME			  Text	 PROY
@WORDSIZE			  Text	 2
ANCHO				  Word	 DATOS:0314
BUSQUEDA			  Near	 CODIGO:0000
COLORCOMMAND			  Byte	 DATOS:0313
ERRORMSG			  Byte	 DATOS:0318
FILEHANDLE			  Word	 DATOS:001B
FILENAME			  Byte	 DATOS:0000
FINAL				  Near	 CODIGO:00C4
FLOOP				  Near	 CODIGO:00B2
HEADER				  Byte	 DATOS:001D
HEADER2				  Byte	 DATOS:0093
INICIO				  Near	 CODIGO:00B6
LARGO				  Word	 DATOS:0316
OPENERROR			  Near	 CODIGO:001E
OPENFILE			  Near	 CODIGO:000F
PALETA				  Byte	 DATOS:000B
PINTAR				  Near	 CODIGO:004B
PLOOP				  Near	 CODIGO:0055
READHEADER			  Near	 CODIGO:0026
SLOOP				  Near	 CODIGO:0070

Groups & Segments		  Bit Size Align  Combine Class

CODIGO				  16  00D2 Para	  none
DATOS				  16  0320 Para	  none
PILA				  16  FFFF Para	  none
