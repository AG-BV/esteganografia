Turbo Assembler	 Version 4.1	    04/18/19 13:05:12	    Page 1
proy.ASM



      1				     include macro.asm
1     2				     pintarM macro
1     3					     mov ah, 0Ch
1     4					     mov al, ColorCommand; color
1     5					     mov bh, 0
1     6					     int 10h
1     7				     endm
1     8
1     9				     ppila macro
1    10					     push cx
1    11					     push bx
1    12					     call busqueda
1    13					     pop cx
1    14				     endm
     15				     ;------------------------------------------------------------------------------
     16
     17	0000			     Pila Segment
     18	0000  FFFF*(??)		      db 0FFFFh	Dup (?)
     19	FFFF			     Pila EndS
     20
     21				     ;------------------------------------------------------------------------------
     22
     23	0000			     Datos Segment
     24	0000  73 74 61 72 2E 62	6D+	     filename db 'star.bmp',0
     25	      70 00
     26
     27	0009  00 04 02 06 01 05	03+	     paleta  db	00h, 04h, 02h, 06h, 01h, 05h, 03h, 07h,	08h, 0Ch, 0Ah, 0Eh, 9h,	0Dh, 0Bh, 0Fh
     28	      07 08 0C 0A 0E 09	0D+
     29	      0B 0F
     30
     31	0019  ????			     filehandle	dw ?
     32
     33	001B  76*(00)			     Header db 118 dup (0)
     34	0091  0280*(00)			     Header2 db	640 dup	(0)
     35	0311  ??			     ColorCommand db ?
     36
     37	0312  ????			     ancho dw ?
     38	0314  ????			     largo dw ?
     39
     40	0316  45 72 72 6F 72 0D	0A+	     ErrorMsg db 'Error', 13, 10,'$'
     41	      24
     42	031E			     Datos EndS
     43
     44	0000			     Codigo Segment
     45				     Assume CS:Codigo, DS:Datos
     46
     47	0000			     busqueda proc near
     48	0000  59			     pop cx
     49	0001  58			     pop ax
     50	0002  51			     push cx
     51	0003  8A C4			     mov al, ah
     52	0005  32 E4			     xor ah, ah
     53	0007  BB 0009r			     lea bx, paleta
     54	000A  D7			     xlat
     55	000B  A2 0311r			     mov ColorCommand, al
     56	000E  C3			     ret
     57	000F			     endP
Turbo Assembler	 Version 4.1	    04/18/19 13:05:12	    Page 2
proy.ASM



     58
     59	000F			     OpenFile proc
     60	000F  B4 3D			     mov ah, 3Dh
     61	0011  32 C0			     xor al, al
     62	0013  BA 0000r			     mov dx, offset filename
     63	0016  CD 21			     int 21h
     64
     65	0018  72 04			     jc	openerror
     66	001A  A3 0019r			     mov [filehandle], ax
     67	001D  C3			     ret
     68
     69	001E				     openerror:
     70	001E  BA 0316r			     mov dx, offset ErrorMsg
     71	0021  B4 09			     mov ah, 9h
     72	0023  CD 21			     int 21h
     73
     74	0025  C3			     ret
     75	0026			     endp OpenFile
     76
     77	0026			     ReadHeader	proc
     78	0026  B4 3F			     mov ah,3fh
     79	0028  8B 1E 0019r		     mov bx,[filehandle]
     80	002C  B9 0076			     mov cx,118
     81	002F  BA 001Br			     mov dx,offset Header
     82	0032  CD 21			     int 21h
     83
     84	0034  50			     push ax
     85	0035  8A 26 002Er		     mov ah, [Header]+19
     86	0039  A0 002Dr			     mov al, [Header]+18
     87	003C  A3 0312r			     mov ancho,	ax
     88
     89	003F  8A 26 0032r		     mov ah, [Header]+23
     90	0043  A0 0031r			     mov al, [Header]+22
     91	0046  A3 0314r			     mov largo,	ax
     92	0049  58			     pop ax
     93
     94	004A  B4 3E			     mov ah,3eh
     95	004C  8B 1E 0019r		     mov bx,FileHandle
     96	0050  CD 21			     int 21h
     97
     98	0052  B4 3D			     mov ah, 3Dh
     99	0054  32 C0			     xor al, al
    100	0056  BA 0000r			     mov dx, offset filename
    101	0059  CD 21			     int 21h
    102
    103	005B  B4 3F			     mov ah,3fh
    104	005D  8B 1E 0019r		     mov bx,[filehandle]
    105	0061  B9 0076			     mov cx,118
    106	0064  BA 001Br			     mov dx,offset Header
    107	0067  CD 21			     int 21h
    108
    109	0069  C3			     ret
    110	006A			     endp ReadHeader
    111
    112	006A			     pintar proc
    113	006A  B4 00			     mov ah, 00h
    114	006C  B0 12			     mov al, 12h
Turbo Assembler	 Version 4.1	    04/18/19 13:05:12	    Page 3
proy.ASM



    115	006E  CD 10			     int 10h
    116	0070  BA 01E0			     mov dx, 1E0H
    117	0073  52			     push dx
    118	0074			     ploop:
    119
    120	0074  B8 3F00			     mov ax,3f00h
    121	0077  8B 1E 0019r		     mov bx,[filehandle]
    122	007B  B9 0140			     mov cx,140h
    123	007E  BA 0091r			     mov dx,offset Header2
    124	0081  CD 21			     int 21h
    125	0083  BE 0091r			     lea si, [header2]
    126	0086  5A			     pop dx
    127	0087  83 FA 00			     cmp dx, 0
    128	008A  74 57			     jz	final
    129	008C  B9 0000			     mov cx, 0
    130	008F				     sloop:
    131	008F  81 F9 0280			     cmp cx, 280h
    132	0093  74 3C				     jz	floop
    133	0095  8A 04				     mov al, byte ptr [si]
    134	0097  8A 24				     mov ah, byte ptr [si]
    135	0099  46				     inc si
    136	009A  24 0F				     and al, 00001111b
    137	009C  80 E4 F0				     and ah, 11110000b
    138	009F  D0 C4 D0 C4 D0 C4	D0+		     rol Ah, 4
    139	      C4
    140	00A7  8B D8				     mov bx, ax
    141	00A9  53				     push bx
    142						     ;---------
    143	00AA  33 C0				     xor ax,ax
    144						     ppila
1   145	00AC  51			     push cx
1   146	00AD  53			     push bx
1   147	00AE  E8 FF4F			     call busqueda
1   148	00B1  59			     pop cx
    149						     pintarM
1   150	00B2  B4 0C			     mov ah, 0Ch
1   151	00B4  A0 0311r			     mov al, ColorCommand; color
1   152	00B7  B7 00			     mov bh, 0
1   153	00B9  CD 10			     int 10h
    154						     ;---------
    155	00BB  41				     inc cx
    156	00BC  5B				     pop bx
    157	00BD  8A FB				     mov bh, bl
    158						     ppila
1   159	00BF  51			     push cx
1   160	00C0  53			     push bx
1   161	00C1  E8 FF3C			     call busqueda
1   162	00C4  59			     pop cx
    163						     pintarM
1   164	00C5  B4 0C			     mov ah, 0Ch
1   165	00C7  A0 0311r			     mov al, ColorCommand; color
1   166	00CA  B7 00			     mov bh, 0
1   167	00CC  CD 10			     int 10h
    168	00CE  41				     inc cx
    169						     ;---------
    170	00CF  EB BE				     jmp sloop
    171	00D1			     floop:
Turbo Assembler	 Version 4.1	    04/18/19 13:05:12	    Page 4
proy.ASM



    172	00D1  4A			     dec dx
    173	00D2  52			     push dx
    174	00D3  EB 9F			     jmp ploop
    175	00D5			     endp pintar
    176
    177	00D5			     Inicio:
    178	00D5  B8 0000s			     mov ax, datos
    179	00D8  8E D8			     mov ds, ax
    180
    181	00DA  E8 FF32			     call openFile
    182	00DD  E8 FF46			     call ReadHeader
    183	00E0  E8 FF87			     call pintar
    184
    185	00E3			     final:
    186	00E3  B4 3E			     mov ah,3eh
    187	00E5  8B 1E 0019r		     mov bx,FileHandle
    188	00E9  CD 21			     int 21h
    189
    190	00EB  B4 10			     mov ah,10h
    191	00ED  CD 16			     int 16h
    192
    193	00EF  B8 0003			     mov ax,0003h
    194	00F2  CD 10			     int 10h
    195
    196	00F4  B8 4C00			     mov ax, 4C00h
    197	00F7  CD 21			     int 21h
    198	00F9			     Codigo EndS
    199					     End Inicio
Turbo Assembler	 Version 4.1	    04/18/19 13:05:12	    Page 5
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "04/18/19"
??FILENAME			  Text	 "proy	  "
??TIME				  Text	 "13:05:12"
??VERSION			  Number 040A
@CPU				  Text	 0101H
@CURSEG				  Text	 CODIGO
@FILENAME			  Text	 PROY
@WORDSIZE			  Text	 2
ANCHO				  Word	 DATOS:0312
BUSQUEDA			  Near	 CODIGO:0000
COLORCOMMAND			  Byte	 DATOS:0311
ERRORMSG			  Byte	 DATOS:0316
FILEHANDLE			  Word	 DATOS:0019
FILENAME			  Byte	 DATOS:0000
FINAL				  Near	 CODIGO:00E3
FLOOP				  Near	 CODIGO:00D1
HEADER				  Byte	 DATOS:001B
HEADER2				  Byte	 DATOS:0091
INICIO				  Near	 CODIGO:00D5
LARGO				  Word	 DATOS:0314
OPENERROR			  Near	 CODIGO:001E
OPENFILE			  Near	 CODIGO:000F
PALETA				  Byte	 DATOS:0009
PINTAR				  Near	 CODIGO:006A
PLOOP				  Near	 CODIGO:0074
READHEADER			  Near	 CODIGO:0026
SLOOP				  Near	 CODIGO:008F

Macro Name

PINTARM
PPILA

Groups & Segments		  Bit Size Align  Combine Class

CODIGO				  16  00F9 Para	  none
DATOS				  16  031E Para	  none
PILA				  16  FFFF Para	  none
